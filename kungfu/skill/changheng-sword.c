// THIS IS PLAYER'S OWN SKILL (write by maxim@nju_fengxue)
// xbd
// 小不懂
// 杀人帮　第三代前任帮主
// 10783776
// 男性
// sword
// 长恨歌





inherit SKILL;

////////////////////////////////

mapping *action = ({

// ZHAOSHI :0

([
"action" :"$N轻声吟唱『汉皇重色思倾国，御宇多年求不得』，手中$w随意向$n的$l挥去",
"force" :60,
"dodge" :40,
"damage_type": "刺伤",
"lvl" : 0,
"skill_name" : "长恨歌第一式"
]),
// ZHAOSHI :1

([
"action" :"$N轻声吟唱『杨家有女初长成，养在深闺人未识』，手中$w随意向$n的$l挥去",
"force" :90,
"dodge" :60,
"damage_type": "刺伤",
"lvl" : 1,
"skill_name" : "长恨歌第二式"
]),
// ZHAOSHI :2

([
"action" :"$N轻声吟唱『天生丽质难自弃，一朝选在君王侧』，手中$w随意向$n的$l挥去",
"force" :120,
"dodge" :80,
"damage_type": "刺伤",
"lvl" : 2,
"skill_name" : "长恨歌第三式"
]),
// ZHAOSHI :3

([
"action" :"$N轻声吟唱『回眸一笑百媚生，六宫粉黛无颜色』，手中$w随意向$n的$l挥去",
"force" :150,
"dodge" :100,
"damage_type": "刺伤",
"lvl" : 3,
"skill_name" : "长恨歌第四式"
]),
// ZHAOSHI :4

([
"action" :"$N轻声吟唱『春寒赐浴华清池，温泉水滑洗凝脂』，手中$w随意向$n的$l挥去",
"force" :180,
"dodge" :120,
"damage_type": "刺伤",
"lvl" : 4,
"skill_name" : "长恨歌第五式"
]),
// ZHAOSHI :5

([
"action" :"$N轻声吟唱『侍儿扶起娇无力，始是新承恩泽时』，手中$w随意向$n的$l挥去",
"force" :210,
"dodge" :140,
"damage_type": "刺伤",
"lvl" : 5,
"skill_name" : "长恨歌第六式"
]),
// ZHAOSHI :6

([
"action" :"$N轻声吟唱『云鬓花颜金步摇，芙蓉帐暖度春宵』，手中$w随意向$n的$l挥去",
"force" :240,
"dodge" :160,
"damage_type": "刺伤",
"lvl" : 6,
"skill_name" : "长恨歌第七式"
]),
// ZHAOSHI :7

([
"action" :"$N轻声吟唱『春宵苦短日高起，从此君王不早朝』，手中$w随意向$n的$l挥去",
"force" :270,
"dodge" :180,
"damage_type": "刺伤",
"lvl" : 7,
"skill_name" : "长恨歌第八式"
]),
// ZHAOSHI :8

([
"action" :"$N轻声吟唱『承欢侍宴无闲暇，春从春游夜专夜』，手中$w随意向$n的$l挥去",
"force" :300,
"dodge" :200,
"damage_type": "刺伤",
"lvl" : 8,
"skill_name" : "长恨歌第九式"
]),
// ZHAOSHI :9

([
"action" :"$N轻声吟唱『后宫佳丽三千人，三千宠爱在一身』，手中$w随意向$n的$l挥去",
"force" :330,
"dodge" :220,
"damage_type": "刺伤",
"lvl" : 9,
"skill_name" : "长恨歌第十式"
]),
// ZHAOSHI :10

([
"action" :"$N轻声吟唱『金星妆成娇侍夜，玉楼宴罢醉和春』，手中$w随意向$n的$l挥去",
"force" :360,
"dodge" :240,
"damage_type": "刺伤",
"lvl" : 10,
"skill_name" : "长恨歌十一式"
]),
// ZHAOSHI :11

([
"action" :"$N轻声吟唱『姊妹弟兄皆列士，可怜光彩生门户』，手中$w随意向$n的$l挥去",
"force" :390,
"dodge" :260,
"damage_type": "刺伤",
"lvl" : 11,
"skill_name" : "长恨歌十二式"
]),
// ZHAOSHI :12

([
"action" :"$N轻声吟唱『遂令天下父母心，不重生男重生女』，手中$w随意向$n的$l挥去",
"force" :420,
"dodge" :280,
"damage_type": "刺伤",
"lvl" : 12,
"skill_name" : "长恨歌十三式"
]),
// ZHAOSHI :13

([
"action" :"$N轻声吟唱『骊宫高处入青云，仙乐风飘处处闻』，手中$w随意向$n的$l挥去",
"force" :450,
"dodge" :300,
"damage_type": "刺伤",
"lvl" : 13,
"skill_name" : "长恨歌十四式"
]),
// ZHAOSHI :14

([
"action" :"$N轻声吟唱『缓歌慢舞凝丝竹，尽日君王看不足』，手中$w随意向$n的$l挥去",
"force" :480,
"dodge" :320,
"damage_type": "刺伤",
"lvl" : 14,
"skill_name" : "长恨歌十五式"
]),
// ZHAOSHI :15

([
"action" :"$N轻声吟唱『渔阳鼙鼓动地来，惊破霓裳羽衣曲』，手中$w随意向$n的$l挥去",
"force" :510,
"dodge" :340,
"damage_type": "刺伤",
"lvl" : 15,
"skill_name" : "长恨歌十六式"
]),
// ZHAOSHI :16

([
"action" :"$N轻声吟唱『九重城阙烟尘生，千乘万骑西南行』，手中$w随意向$n的$l挥去",
"force" :540,
"dodge" :360,
"damage_type": "刺伤",
"lvl" : 16,
"skill_name" : "长恨歌十七式"
]),
// ZHAOSHI :17

([
"action" :"$N轻声吟唱『翠华摇摇行复止，西出都门百馀里』，手中$w随意向$n的$l挥去",
"force" :570,
"dodge" :380,
"damage_type": "刺伤",
"lvl" : 17,
"skill_name" : "长恨歌十八式"
]),
// ZHAOSHI :18

([
"action" :"$N轻声吟唱『六军不发无奈何，宛转蛾眉马前死』，手中$w随意向$n的$l挥去",
"force" :600,
"dodge" :400,
"damage_type": "刺伤",
"lvl" : 18,
"skill_name" : "长恨歌十九式"
]),
// ZHAOSHI :19

([
"action" :"$N轻声吟唱『花钿委地无人收，翠翘金雀玉搔头』，手中$w随意向$n的$l挥去",
"force" :630,
"dodge" :420,
"damage_type": "刺伤",
"lvl" : 19,
"skill_name" : "长恨歌二十式"
]),
// ZHAOSHI :20

([
"action" :"$N轻声吟唱『君王掩面救不得，回看血泪相和流』，手中$w随意向$n的$l挥去",
"force" :660,
"dodge" :440,
"damage_type": "刺伤",
"lvl" : 20,
"skill_name" : "长恨歌二一式"
]),
// ZHAOSHI :21

([
"action" :"$N轻声吟唱『黄埃散漫风萧索，云栈萦纡登剑阁』，手中$w随意向$n的$l挥去",
"force" :690,
"dodge" :460,
"damage_type": "刺伤",
"lvl" : 21,
"skill_name" : "长恨歌二二式"
]),
// ZHAOSHI :22

([
"action" :"$N轻声吟唱『峨嵋山下少人行，旌旗无光日色薄』，手中$w随意向$n的$l挥去",
"force" :720,
"dodge" :480,
"damage_type": "刺伤",
"lvl" : 22,
"skill_name" : "长恨歌二三式"
]),
// ZHAOSHI :23

([
"action" :"$N轻声吟唱『蜀江水碧蜀山青，圣主朝朝暮暮情』，手中$w随意向$n的$l挥去",
"force" :750,
"dodge" :500,
"damage_type": "刺伤",
"lvl" : 23,
"skill_name" : "长恨歌二四式"
]),
// ZHAOSHI :24

([
"action" :"$N轻声吟唱『行宫见月伤心色，夜雨闻铃肠断声』，手中$w随意向$n的$l挥去",
"force" :780,
"dodge" :520,
"damage_type": "刺伤",
"lvl" : 24,
"skill_name" : "长恨歌二五式"
]),
// ZHAOSHI :25

([
"action" :"$N轻声吟唱『天旋地转回龙驭，到此踌躇不能去』，手中$w随意向$n的$l挥去",
"force" :810,
"dodge" :540,
"damage_type": "刺伤",
"lvl" : 25,
"skill_name" : "长恨歌二六式"
]),
 });
// ZHAOSHI :26
int valid_learn(object me)
{
object weapon; if (!objectp(weapon = me->query_temp("weapon"))
     || (string)weapon->query("skill_type") != "sword") return notify_fail("你使用的武器不对。\n");
	if( (int)me->query("max_neili") < 50 )
		return notify_fail("你的内力太弱，无法练"+"长恨歌"+"。\n");
	return 1;
}
int valid_enable(string usage) { return usage=="sword" || usage=="parry"; }
string query_skill_name(int level)
{
        int i;
        for(i = sizeof(action)-1; i >= 0; i--)
                if(level >= action[i]["lvl"])
                        return action[i]["skill_name"];
}
mapping query_action(object me, object weapon)
{
        int i, level;
    level = (int)me->query_skill("changheng-sword",1);
        for(i = sizeof(action); i > 0; i--)
                if(level > action[i-1]["lvl"])
                        return action[NewRandom(i, 20, level/5)];
}
int practice_skill(object me)
{
object weapon; if (!objectp(weapon = me->query_temp("weapon")) || (string)weapon->query("skill_type") != "sword") return notify_fail("你使用的武器不对。\n");	if( (int)me->query("qi") < 25 )
		return notify_fail("你的体力不够了，休息一下再练吧。\n");
	if( (int)me->query("neili") < 3 )
		return notify_fail("你的内力不够了，休息一下再练吧。\n");
	me->receive_damage("qi", 25);
	me->add("neili", -3);
	return 1;
} //total 34 lines!
