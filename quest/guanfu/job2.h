#include <ansi.h>

mapping *quest = ({
  ({
  (["name":                "江湖宵小",
    "where" :              "/quest/guanfu/npc/xiaoxiao",]), 
   (["name":                "山贼王", 
    "where" :              "/quest/guanfu/npc/shanzei",]),
    }), 
    ({
     (["name":                "山贼王", 
    "where" :              "/quest/guanfu/npc/shanzei",]),
     (["name":                "盖一鸣",
     "where" :              "/quest/guanfu/npc/gaiyiming",]),
     (["name":                "常长风",
     "where" :              "/quest/guanfu/npc/chang",]),
      (["name":                "花剑影",
     "where" :                "/quest/guanfu/npc/hua",]),
      (["name":                "黄须道人",
     "where" :                "/quest/guanfu/npc/huangxu",]),
     (["name":                "恶僧",
     "where" :                "/quest/guanfu/npc/eseng",]),
      (["name":                "曹化淳",
     "where" :                "/quest/guanfu/npc/cao",]),
      (["name":                "朱安国",
     "where" :                "/quest/guanfu/npc/zhu",]),
      }), 
      ({
         (["name":                "江洋大盗 王三",
     "where" :                "/quest/guanfu/npc/dadao",]),
       (["name":                "草寇",
     "where" :                "/quest/guanfu/npc/caokou",]),
      (["name":                "恶霸",
     "where" :                "/quest/guanfu/npc/eba",]),
      (["name":                "宋扬",
     "where" :                 "/quest/guanfu/npc/songyang",]),
      (["name":               "全二风",
     "where" :                 "/quest/guanfu/npc/quan",]),
      (["name":               "孟正鹏",
     "where" :                 "/quest/guanfu/npc/meng",]),
      (["name":               "鲜于通",
     "where" :                 "/quest/guanfu/npc/xian",]),
      (["name":               "麦鲸",
     "where" :                 "/quest/guanfu/npc/maijing",]),
      (["name":               "过三拳",
     "where" :                 "/quest/guanfu/npc/guo",]),
       }), 
      ({
      (["name":               "大盗赵一伤",
     "where" :                 "/quest/guanfu/npc/zhaoyishang",]),   
      (["name":               "大盗钱二败",
     "where" :                 "/quest/guanfu/npc/qian",]),    
      (["name":               "大盗孙三毁",
     "where" :                 "/quest/guanfu/npc/sun",]),  
      (["name":               "大盗李四摧",
     "where" :                 "/quest/guanfu/npc/li",]), 
      (["name":               "大盗周五输",
     "where" :                 "/quest/guanfu/npc/zhou",]), 
      (["name":               "大盗吴六破",
     "where" :                 "/quest/guanfu/npc/wu",]), 
      (["name":               "大盗郑七灭",
     "where" :                 "/quest/guanfu/npc/zheng",]), 
      (["name":               "元广波",
     "where" :                 "/quest/guanfu/npc/yuan",]), 
      (["name":               "徐长老",
     "where" :                 "/quest/guanfu/npc/xu",]), 
      (["name":               "单狰",
     "where" :                 "/quest/guanfu/npc/shan",]), 
      (["name":               "霍元风",
     "where" :                 "/quest/guanfu/npc/huo",]),
      }), 
      ({
      (["name":               "阿大",
     "where" :                 "/quest/guanfu/npc/ada",]),  
      (["name":               "阿二",
     "where" :                 "/quest/guanfu/npc/aer",]), 
      (["name":               "阿三",
     "where" :                 "/quest/guanfu/npc/asan",]), 
      (["name":               "玉真子",
     "where" :                 "/quest/guanfu/npc/yu",]),    
     }),
     });
mapping *wheres=({
          
      (["chinese":                "大理北门",
       "weizhi" :              "/d/dali/northgate",]),  
      (["chinese":                "扬州密林",
       "weizhi" :              "/d/city/jiaowai5",]),  
     (["chinese":                "峨嵋草棚",
       "weizhi" :              "/d/emei/caopeng",]),
     (["chinese":                "襄阳玄武内门",
       "weizhi" :              "/d/xiangyang/northgate1",]),
     (["chinese":                "襄阳青龙内门",
       "weizhi" :              "/d/xiangyang/eastgate1",]),
     (["chinese":                "扬州通泗门",
       "weizhi" :              "/d/city/ximen",]),
     (["chinese":                "雪山土路",
       "weizhi" :              "/d/xueshan/tulu2",]),
     (["chinese":                "苏州留园",
       "weizhi" :              "/d/suzhou/liuyuan",]),
     (["chinese":                "苏州寒山寺",
       "weizhi" :              "/d/suzhou/hanshansi",]),
     (["chinese":                "杭州飞来峰",
       "weizhi" :              "/d/hangzhou/feilaifeng",]),
     (["chinese":                "杭州净慈寺",
       "weizhi" :              "/d/hangzhou/jingcisi",]),
     (["chinese":                "杭州翠微亭",
       "weizhi" :              "/d/hangzhou/cuiweiting",]),
     (["chinese":                "杭州聚景园",
       "weizhi" :              "/d/hangzhou/jujingyuan",]),
     (["chinese":                "苗疆易溪部",
       "weizhi" :              "/d/dali/yixibu",]),  
      (["chinese":                "扬州中央广场",
       "weizhi" :              "/d/city/guangchang",]),  
      (["chinese":                "杭州沿湖大道",
       "weizhi" :              "/d/hangzhou/dadao1",]), 
      (["chinese":                "杭州断桥",
       "weizhi" :              "/d/hangzhou/duanqiao",]), 
      (["chinese":                "杭州灵隐寺",
       "weizhi" :              "/d/hangzhou/lingyinsi",]), 
      (["chinese":                "星宿海伊犁",
       "weizhi" :              "/d/xingxiu/beijiang",]), 
      (["chinese":                "武当三天门",
       "weizhi" :              "/d/wudang/santiangate",]), 
      (["chinese":                "峨嵋十二盘",
       "weizhi" :              "/d/emei/shierpan3",]), 
      (["chinese":                "峨嵋千佛庵",
       "weizhi" :              "/d/emei/qianfoan",]), 
      (["chinese":                "峨嵋九十九道拐",
       "weizhi" :              "/d/emei/jsjdg1",]), 
      (["chinese":                "明教厚土旗门",
       "weizhi" :              "/d/mingjiao/htqmen",]), 
      (["chinese":                "明教烈火旗后门",
       "weizhi" :              "/d/mingjiao/lhqhoumen",]), 
      (["chinese":                "福州东门",
       "weizhi" :              "/d/fuzhou/dongmen",]), 
      (["chinese":                "福州北大街",
       "weizhi" :              "/d/fuzhou/beidajie",]), 
      (["chinese":                "星宿海沙漠",
       "weizhi" :              "/d/xingxiu/shamo2",]),
      (["chinese":                "少林寺石阶",
       "weizhi" :              "/d/shaolin/shijie4",]),
      (["chinese":                "襄阳石阶",
       "weizhi" :              "/d/xiangyang/walle1",]),
      (["chinese":                "华山猢狲愁",
       "weizhi" :              "/d/huashan/husun",]),
      (["chinese":                "华山玉女峰",
       "weizhi" :              "/d/huashan/yunu",]),
      (["chinese":                "慕容小径",
       "weizhi" :              "/d/mr/xiaojing1-2",]),
      (["chinese":                "慕容柳树林",
       "weizhi" :              "/d/mr/liulin",]),
      (["chinese":                "大理大和街",
       "weizhi" :              "/d/dali/dahejiewest",]),
      (["chinese":                "苏州城北门",
       "weizhi" :              "/d/suzhou/beimen",]),
      (["chinese":                "苏州城玄妙观",
       "weizhi" :              "/d/suzhou/xuanmiao",]),
      (["chinese":                "苏州城紫金庵",
       "weizhi" :              "/d/suzhou/zijinan",]),
      (["chinese":                "少林寺山门殿",
       "weizhi" :              "/d/shaolin/smdian",]),
      (["chinese":                "少林寺走廊",
       "weizhi" :              "/d/shaolin/zoulang7",]),
      (["chinese":                "武当山路",
       "weizhi" :              "/d/wudang/shanlu3",]),
      (["chinese":                "少林寺般若堂九部",
       "weizhi" :              "/d/shaolin/banruo9",]),
      (["chinese":                "雪山山脚",
       "weizhi" :              "/d/xueshan/shanjiao",]),
      (["chinese":                "峨嵋九老洞",
       "weizhi" :              "/d/emei/jiulaodong",]),
       (["chinese":                "峨嵋古德林",
       "weizhi" :              "/d/emei/gudelin1",]),
       (["chinese":                "台湾红毛城",
       "weizhi" :              "/d/taiwan/hongmaocheng",]),
       (["chinese":                "宜兴",
       "weizhi" :              "/d/yixing/yixing",]),
       (["chinese":                "无锡莲蓉门",
       "weizhi" :              "/d/wuxi/northgate",]),
       (["chinese":                "岳阳南街",
       "weizhi" :              "/d/yueyang/nanjie",]),
       (["chinese":                "江陵南门",
       "weizhi" :              "/d/jiangling/nanmen",]),
       (["chinese":                "洛阳南门",
       "weizhi" :              "/d/luoyang/southgate",]),
       (["chinese":                "日本海港",
       "weizhi" :              "/d/japan/haigang",]),
       (["chinese":                "开封石拱门",
       "weizhi" :              "/d/kaifeng/gongmen",]),       
           });
void init()
{
        add_action("do_jie", ({"xian","jie"}));
     
}

int do_jie(string arg)
{
	object me, ob;
        mapping weizhis, target;
//	string  weishis;
	int exp, position;

	if(!arg) return 0;
	me = this_player();
        ob = this_player(); 
	exp=(int)me->query("combat_exp"); 
        weizhis = wheres[random(sizeof(wheres))];
//        weishis = quest[random(sizeof(wheres))];

	if(arg != "wenshu" && arg != "wen") return 0;

	if(me->query_condition("gb_mission") || me->query_condition("gb_busy") || me->query_condition("xx_task")
        || me->query_condition("dali_songxin"))
		return notify_fail("你现在正忙着做其他任务呢！\n");
	if(me->query_condition("guanfu_task"))
		return notify_fail("你已经揭过榜了，难道不想做了？！\n");
	if(me->query_temp("guanfu_task") || present("wenshu", me))
        return notify_fail("你身上还有文书，可以通过(kan wenshu)来查询。\n");
        if ((int)me->query_condition("guojob2_busy"))
		return notify_fail("你休息一会再来？！\n");
		if(me->query_condition("gf_busy"))
        return notify_fail("你发现文书已经被人揭光了，看样子要等一会了！\n");

    if(exp<50000)
		return notify_fail("你刚想伸手，忽然看到上面凶神恶煞的画像，想了想觉得自己的这点功夫，还是算了吧。\n"); 
	if(exp>=775000) position=5;
	else if(exp>=380000) position=4;
	else if(exp>=120000) position=3;
	else if(exp>=50000) position=2;
	else position=1;
//        target = quest[random(sizeof(quest))];
	target = quest[position-1][random(sizeof(quest[position-1]))]; 
//      while (sizeof(filter_array(children(target["where"]), (: clonep :))) > 0)
        target = quest[position-1][random(sizeof(quest[position-1]))];
        
        if(exp>=380000){
	tell_room(this_object(),
		HIY + me->name()
		+ "推开围观的行人，走到近前,微微睁开眼睛，冷冷瞥了一眼告示，随手揭了下来揣进了怀中。\n"NOR, ({ me }));
	write(HIY"你推开围观的行人，走到近前,微微睁开眼睛，冷冷瞥了一眼告示，随手揭了下来揣进了怀中。\n"NOR);
	 }
        if(exp<=120000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "壮了壮胆，费力拔开行人，来到近前深深吸了口气，竭力镇定一下紧张的心情，四下看了看，悄悄把文书揭了下来。\n"NOR, ({ me }));
        write(HIY"你壮了壮胆，费力拔开行人，来到近前深深吸了口气，竭力镇定一下紧张的心情，四下看了看，悄悄把文书揭了下来。\n"NOR);
         }
        if(exp>120000 && exp<380000){
        tell_room(this_object(),
                 HIY + me->name()
                 + "分开行人来到近前，目光淡淡的扫视了几眼告示，嘴角微微一翘，神态自如的把文书揭了下来。\n"NOR, ({ me }));
        write(HIY"你分开行人来到近前，目光淡淡的扫视了几眼告示，嘴角微微一翘，神态自如的把文书揭了下来。\n"NOR);
        }
        me->set_temp("mark/gkill1",1);
	me->set_temp("guanfu_target", target["name"]);
        me->set_temp("path_rooms", target["where"]);
        me->set_temp("gstart_rooms", weizhis["weizhi"]);
        me->set_temp("ch_weizhi", weizhis["chinese"]);
        new(__DIR__"wenshu1")->move(me);
//       me->move(me->query_temp("start_rooms"));
        ob = new(me->query_temp("path_rooms"));
//      ob->move("/d/city/kongchang");
        ob->move(me->query_temp("gstart_rooms"));
        me->apply_condition("guanfu_task", me->set_temp("guanfu_time", random(70)+20));
        me->apply_condition("gf_busy", random(20)+3);
        
	return 1;
}
